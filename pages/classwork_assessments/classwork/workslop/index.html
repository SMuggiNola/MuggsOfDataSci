<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>Workslop and Authentic Work | Muggs of Data Science</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Cormorant Garamond', serif;
      color: #f5eedb;
      background: radial-gradient(circle at center, #0e2a1b 0%, #153b26 100%), url('../../../images/book-of-kells.jpg');
      background-blend-mode: multiply;
      background-size: cover;
      background-attachment: fixed;
      text-align: center;
      margin: 0;
      padding: 2rem;
      min-height: 100vh;
    }

    h1 {
      font-family: 'Cinzel Decorative', serif;
      color: #c89b3c;
      font-size: clamp(2rem, 6vw, 2.8rem);
      text-shadow: 0 0 6px rgba(200,155,60,0.5);
      margin-bottom: 1rem;
    }

    h2 {
      color: #d4af37;
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }

    p {
      font-size: 1.1rem;
      line-height: 1.6;
      max-width: 800px;
      margin: 0.5rem auto;
    }

    a {
      color: #c89b3c;
      text-decoration: none;
      font-weight: 600;
    }

    a:hover { color: #d4af37; text-decoration: underline; }

    .info, .question-box {
      margin: 1.5rem auto;
      max-width: 700px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(200,155,60,0.3);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      text-align: left;
    }

    button {
      background-color: #c89b3c;
      border: none;
      color: #0e2a1b;
      padding: 0.6rem 1.4rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
      font-weight: bold;
      font-family: 'Cormorant Garamond', serif;
    }

    button:hover { background-color: #d4af37; }

    textarea {
      width: 90%;
      margin-top: 0.5rem;
      border-radius: 6px;
      padding: 0.5rem;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem;
    }

    footer {
      color: #b3a37d;
      margin-top: 3rem;
      font-size: 0.9rem;
    }

    .option {
      display: block;
      margin: 0.4rem 0;
      cursor: pointer;
    }

    .back-button {
      display: inline-block;
      background-color: #c89b3c;
      color: #0e2a1b;
      font-family: 'Cormorant Garamond', serif;
      padding: 0.6rem 1.4rem;
      border-radius: 8px;
      margin-top: 2rem;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .back-button:hover {
      background-color: #d4af37;
      transform: translateY(-2px);
    }
  </style>
</head>

<body>
  <h1>Workslop and Authentic Work</h1>

  <p>
    <a href="https://hbr.org/2025/09/ai-generated-workslop-is-destroying-productivity" target="_blank">
      Read on Harvard Business Review →
    </a>
    <br>
    <a href="AI-Generated_Workslop_Is_Destroying_Productivity.pdf" target="_blank">
      Download Article (PDF)
    </a>
  </p>

  <div id="info" class="info">
    <h2>Ready to Begin?</h2>
    <p>Click below to start the activity.</p>
    <button id="startActivityBtn">Start Activity</button>
  </div>

  <div id="question-container" class="question-box" style="display:none;">
    <h2>Loading activity...</h2>
  </div>

  <!-- Back button -->
  <a href="../index.html" class="back-button">← Back to Classwork</a>

  <footer>
    Designed for <strong>Muggs of Data Science</strong> · Built for educational use only
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const startBtn = document.getElementById('startActivityBtn');
      const infoBox = document.getElementById('info');
      const questionBox = document.getElementById('question-container');

      startBtn.addEventListener('click', async () => {
        const username = prompt("Enter your username to begin.\n(For now, any name will work.)");
        if (!username || username.trim() === "") {
          alert("Please enter a username to start.");
          return;
        }

        localStorage.setItem('studentUsername', username.trim());
        infoBox.innerHTML = `<h2>Welcome, ${username}!</h2><p>Begin your activity below.</p>`;
        questionBox.style.display = 'block';

        try {
          const response = await fetch('activity.json');
          if (!response.ok) throw new Error("Could not load activity file.");
          const activity = await response.json();
          startActivity(activity);
        } catch (err) {
          questionBox.innerHTML = `<p style="color:#ffb347;">Error loading activity: ${err.message}</p>`;
        }
      });

      function startActivity(activity) {
        const groupA = activity.questions.filter(q => q.group === "A");
        const groupB = activity.questions.filter(q => q.group === "B");
        const selectedA = groupA.sort(() => Math.random() - 0.5).slice(0, 5);
        const selectedB = groupB.sort(() => Math.random() - 0.5).slice(0, 5);
        const selectedQuestions = [...selectedA, ...selectedB].sort(() => Math.random() - 0.5);
        renderQuestions(activity, selectedQuestions);
      }

      function renderQuestions(activity, selectedQuestions) {
        let html = `
          <h2>${activity.title}</h2>
          <p><strong>Objective:</strong> ${activity.objective}</p>
          <ol>
        `;

        selectedQuestions.forEach(q => {
          html += `
            <li style="margin-bottom:1rem;">
              <p><strong>${q.question}</strong></p>
              ${q.options.map(opt => `
                <label class="option">
                  <input type="radio" name="${q.id}" value="${opt}"> ${opt}
                </label>
              `).join('')}
            </li>
          `;
        });

        html += `</ol><h3>Reflection Questions (answer at least two):</h3><ol>`;
        activity.reflections.forEach(r => {
          html += `
            <li style="margin-bottom:1rem;">
              <p><strong>${r.question}</strong></p>
              <textarea id="${r.id}" rows="4" placeholder="Write your response..."></textarea>
            </li>
          `;
        });

        html += `
          </ol>
          <button id="submitBtn">Submit Activity</button>
          <p id="submitMessage" style="margin-top:1rem;"></p>
        `;
        questionBox.innerHTML = html;

        document.getElementById('submitBtn').addEventListener('click', () => handleSubmit(activity, selectedQuestions));
      }

      function handleSubmit(activity, selectedQuestions) {
        const username = localStorage.getItem('studentUsername') || "anonymous";
        const responses = {};

        selectedQuestions.forEach(q => {
          const selected = document.querySelector(`input[name="${q.id}"]:checked`);
          responses[q.id] = selected ? selected.value : null;
        });

        const reflectionResponses = {};
        let reflectionCount = 0;
        activity.reflections.forEach(r => {
          const val = document.getElementById(r.id).value.trim();
          if (val) reflectionCount++;
          reflectionResponses[r.id] = val;
        });

        if (reflectionCount < 2) {
          alert("Please answer at least two reflection questions before submitting.");
          return;
        }

        let correct = 0;
        let total = selectedQuestions.length;
        selectedQuestions.forEach(q => {
          if (q.answer && responses[q.id] === q.answer) correct++;
        });
        const percent = Math.round((correct / total) * 100);

        const msg = document.getElementById('submitMessage');
        msg.style.color = '#d4af37';
        msg.innerHTML = `
          ✅ You answered ${correct} out of ${total} correctly.
          <br><strong>Score: ${percent}%</strong>
          <br>Submitting your responses to the cloud...
        `;

        const submission = {
          username,
          activity_id: activity.activity_id,
          timestamp: new Date().toISOString(),
          selected_questions: selectedQuestions.map(q => q.id),
          responses,
          reflections: reflectionResponses,
          score: { correct, total, percent }
        };

        fetch("https://muggs-data-worker.sean-muggivan.workers.dev/save", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(submission)
        })
          .then(res => res.json())
          .then(data => {
            msg.innerHTML += `
              <br><br>☁️ <strong>Cloudflare submission successful!</strong>
              <br>Record ID: ${data.key}
            `;
          })
          .catch(err => {
            msg.innerHTML += `
              <br><br>⚠️ <strong>Cloudflare submission failed:</strong> ${err.message}
            `;
          });
      }
    });
  </script>
</body>
</html>
